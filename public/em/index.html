<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>구독 간편조회 - 이마트</title>
    <link rel="stylesheet" href="../shared/style.css">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../mobile.css">
    <script>window.CHANNEL = 'em';</script>
</head>
<body>
    <script src="/auth.js"></script>
    <div class="container">
        <!-- 헤더 -->
        <header class="header">
            <div class="header-content">
                <h1>구독 간편조회<span class="channel-version">&nbsp; (이마트) ver3</span></h1>
                <a href="/" class="back-to-main" style="position: fixed; right: 220px; top: 25px; text-decoration: none; color: #666; font-size: 13px; display: flex; align-items: center; gap: 5px; padding: 8px 12px; background: white; border-radius: 6px; transition: all 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #ddd; height: 36px; box-sizing: border-box;" onmouseover="this.style.background='#f5f5f5'; this.style.color='#333';" onmouseout="this.style.background='white'; this.style.color='#666';">
                    <span style="font-size: 16px;">←</span> 채널 선택
                </a>
            </div>
        </header>

        <div class="main-content">
            <!-- 왼쪽 계산기 영역 -->
            <aside class="calculator-sidebar">
                <div class="calculator-header">
                    <h2>가전구독 혜택</h2>
                    <label style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); display: flex; align-items: center; font-size: 12px; color: #666; cursor: pointer;">
                        <input type="checkbox" id="showTotalCost" style="margin-right: 5px; cursor: pointer;">
                        총혜택 보기
                    </label>
                </div>
                
                <!-- 구독 타입별 혜택 -->
                <div class="benefit-section">
                    <div class="benefit-item active" data-type="single">
                        <div class="benefit-title">정상 구독료</div>
                        <div class="benefit-price" id="normalPrice">0원</div>
                    </div>
                    
                    <div class="benefit-item" data-type="promotion">
                        <div class="benefit-header">
                            <div class="benefit-title">추가혜택</div>
                        </div>
                        <div class="benefit-price" id="promotionPrice">0원</div>
                        <div class="benefit-details" id="benefitDetails">
                            <div class="benefit-detail" id="promotionDiscountDetail">• 프로모션할인: 0원</div>
                            <div class="benefit-detail" id="combinationDiscountDetail">• 결합할인: 0원</div>
                            <div class="benefit-detail" id="partnerCardDetail">• 제휴카드: 0원</div>
                        </div>
                    </div>
                    
                    <div class="benefit-item prepayment-section" id="prepaymentSection" style="display: none;">
                        <div class="benefit-title">선납금액 💳</div>
                        <div class="benefit-price prepayment-price" id="prepaymentPrice">0원</div>
                        <div class="benefit-details">
                            <div class="benefit-detail small-text">선납 선택 시 한번에 납부할 금액</div>
                            <div class="benefit-detail" id="prepaymentDetail">• 해당 제품 없음</div>
                        </div>
                    </div>
                </div>
                
                <div class="final-total">
                    <div class="final-message">최종 체감 구독료(월)입니다.</div>
                    <div class="final-price" id="finalPrice">0원</div>
                </div>
            </aside>

            <!-- 우측 제품 선택 영역 -->
            <main class="products-main">
                <div class="products-header">
                    <button id="subscriptionBenefitsBtn" class="subscription-benefits-btn">
                        <span class="benefits-icon">🎁</span>
                        <span>구독 혜택</span>
                    </button>
                </div>
                <div class="products-grid" id="productsGrid">
                    <!-- 선택된 제품 카드들이 여기에 표시됩니다 -->
                    <div class="add-product-card" id="addProductCard">
                        <div class="add-product-content">
                            <div class="add-icon">+</div>
                            <div class="add-text">제품 추가</div>
                        </div>
                    </div>
                </div>
                
                <!-- 웰컴 메시지 (제품이 없을 때) -->
                <div class="welcome-message" id="welcomeMessage">
                    <h3>구독하고 싶은 제품을 선택해보세요</h3>
                    <p>다양한 가전제품을 월 구독료로 이용할 수 있습니다.</p>
                </div>
            </main>
        </div>
        
        <!-- 워터마크 시그니처 -->
        <div class="watermark-signature">designed by 하동훈</div>
    </div>
    
    <!-- 모바일 하단 혜택 패널 -->
    <div id="mobile-benefit-panel" class="mobile-benefit-panel collapsed" style="display: none;">
        <div class="mobile-benefit-header" onclick="toggleBenefitPanel()">
            <span id="benefit-panel-text">가전 구독 혜택 ▲</span>
        </div>
        <div class="mobile-benefit-content">
            <div style="text-align: center; margin-bottom: 20px;">
                <h3 style="color: #333; font-size: 16px; margin: 0 0 10px 0;">🎁 가전 구독 혜택</h3>
                <p style="color: #666; font-size: 12px; margin: 0;">월 구독료로 이용하는 다양한 혜택을 확인해보세요</p>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 20px; margin-bottom: 8px;">🛠️</div>
                    <div style="font-size: 12px; font-weight: 600; color: #333;">설치/철거 무료</div>
                    <div style="font-size: 10px; color: #666; margin-top: 4px;">전문 기사 방문</div>
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 20px; margin-bottom: 8px;">🔧</div>
                    <div style="font-size: 12px; font-weight: 600; color: #333;">A/S 무제한</div>
                    <div style="font-size: 10px; color: #666; margin-top: 4px;">고장 시 즉시 수리</div>
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 20px; margin-bottom: 8px;">🚚</div>
                    <div style="font-size: 12px; font-weight: 600; color: #333;">배송 무료</div>
                    <div style="font-size: 10px; color: #666; margin-top: 4px;">설치까지 원스톱</div>
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 20px; margin-bottom: 8px;">💰</div>
                    <div style="font-size: 12px; font-weight: 600; color: #333;">경제적</div>
                    <div style="font-size: 10px; color: #666; margin-top: 4px;">월 소액으로 이용</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 제품 선택 모달 -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>제품 선택</h2>
                <span class="close-btn" id="closeModal">&times;</span>
            </div>
            
            <!-- 단계 표시기 -->
            <div class="step-indicator">
                <div class="step active" data-step="1">
                    <span class="step-number">1</span>
                    <span class="step-label">제품군</span>
                </div>
                <div class="step" data-step="2">
                    <span class="step-number">2</span>
                    <span class="step-label">모델명</span>
                </div>
                <div class="step" data-step="3">
                    <span class="step-number">3</span>
                    <span class="step-label">결합유형</span>
                </div>
                <div class="step" data-step="4">
                    <span class="step-number">4</span>
                    <span class="step-label">계약기간</span>
                </div>
                <div class="step" data-step="5">
                    <span class="step-number">5</span>
                    <span class="step-label">관리유형</span>
                </div>
                <div class="step" data-step="6">
                    <span class="step-number">6</span>
                    <span class="step-label">방문주기</span>
                </div>
                <div class="step" data-step="7">
                    <span class="step-number">7</span>
                    <span class="step-label">선납</span>
                </div>
            </div>

            <!-- 스크롤 가능한 내용 영역 -->
            <div class="modal-scroll-content">
                <!-- 단계별 선택 영역 -->
                <div class="step-content">
                    <div class="step-header">
                        <div class="step-title" id="stepTitle">제품군을 선택해주세요</div>
                        <button id="prevBtnTop" class="btn btn-secondary btn-small" style="display: none;">← 이전</button>
                    </div>
                    
                    <!-- 검색창 (많은 옵션이 있을 때만 표시) -->
                    <div class="search-section" id="searchSection" style="display: none;">
                        <input type="text" id="optionSearch" placeholder="검색어를 입력하세요..." />
                        <div class="search-result-count" id="searchResultCount"></div>
                    </div>
                    
                    <div class="options-grid" id="optionsGrid">
                        <!-- 선택 옵션들이 동적으로 추가됩니다 -->
                    </div>
                </div>

                <!-- 선택 내역 표시 -->
                <div class="selection-summary">
                    <h4>선택 내역</h4>
                    <div class="selection-items" id="selectionItems">
                        <!-- 선택된 내역들이 표시됩니다 -->
                    </div>
                </div>

                <!-- 버튼 영역 (자동 진행으로 인해 숨김) -->
                <div class="modal-footer" style="display: none;">
                    <button id="skipBtn" class="btn btn-secondary">건너뛰기</button>
                    <button id="addBtn" class="btn btn-success">제품 추가</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 제휴카드 모달 -->
    <div id="partnerCardModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>제휴카드 선택</h2>
                <span class="close-btn" onclick="calculator.closePartnerCardModal()">&times;</span>
            </div>
            
            <div class="modal-body">
                <p>제품에 적용할 제휴카드를 선택해주세요.</p>
                <div id="partnerCardOptions" class="partner-card-grid">
                    <!-- 제휴카드 옵션들이 여기에 동적으로 추가됩니다 -->
                </div>
            </div>
            
            <div class="modal-footer">
                <button onclick="calculator.closePartnerCardModal()" class="btn btn-secondary">취소</button>
                <button onclick="calculator.applyPartnerCard()" class="btn btn-primary">적용</button>
            </div>
        </div>
    </div>

    <!-- 구독 혜택 모달 -->
    <div id="subscriptionBenefitsModal" class="modal">
        <div class="modal-content benefits-modal-content">
            <div class="modal-header">
                <h2>구독 혜택</h2>
                <span class="close-btn" onclick="closeBenefitsModal()">&times;</span>
            </div>
            
            <div class="modal-body">
                <p>구독 시 받을 수 있는 다양한 케어 서비스 혜택을 확인해보세요.</p>
                <div id="benefitsGrid" class="benefits-grid">
                    <!-- 구독 혜택 버튼들이 여기에 동적으로 추가됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 구독 혜택 상세 모달 -->
    <div id="benefitDetailModal" class="modal">
        <div class="modal-content benefit-detail-content">
            <div class="modal-header">
                <h2 id="benefitDetailTitle">혜택 상세</h2>
                <span class="close-btn" onclick="closeBenefitDetailModal()">&times;</span>
            </div>
            
            <div class="modal-body">
                <div id="benefitDetailContent">
                    <!-- 상세 내용이 여기에 로드됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <script src="../shared/script.js"></script>
    <script src="../product-modal.js"></script>
    <script src="../script.js"></script>
    
    <!-- 모바일 3개 버튼 생성 스크립트 -->
    <script>
    function createMobileButtons() {
        // 이미 버튼이 있으면 생성하지 않음
        if (document.getElementById('mobile-buttons-container')) return;
        
        // 모바일에서만 실행
        if (window.innerWidth > 768) return;
        
        // 헤더 컨텐츠 찾기
        const headerContent = document.querySelector('.header-content');
        if (!headerContent) return;
        
        // 3개 버튼 컨테이너 생성
        const buttonsContainer = document.createElement('div');
        buttonsContainer.id = 'mobile-buttons-container';
        buttonsContainer.style.cssText = `
            display: flex !important;
            gap: 8px !important;
            margin-top: 15px !important;
            width: 100% !important;
        `;
        
        // 1. 구독혜택 버튼
        const benefitsBtn = document.createElement('button');
        benefitsBtn.innerHTML = '<span style="font-size: 16px; margin-bottom: 2px;">🎁</span><br>구독혜택';
        benefitsBtn.onclick = () => document.getElementById('subscriptionBenefitsBtn').click();
        benefitsBtn.style.cssText = `
            flex: 1 !important;
            padding: 10px 5px !important;
            background: white !important;
            border: 1px solid #ddd !important;
            border-radius: 8px !important;
            font-size: 11px !important;
            color: #333 !important;
            text-decoration: none !important;
            min-height: 50px !important;
            cursor: pointer !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            font-weight: 500 !important;
            line-height: 1.2 !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
        `;
        
        // 2. 채널선택 버튼
        const channelBtn = document.createElement('a');
        channelBtn.href = '/';
        channelBtn.innerHTML = '<span style="font-size: 16px; margin-bottom: 2px;">🏪</span><br>채널선택';
        channelBtn.style.cssText = `
            flex: 1 !important;
            padding: 10px 5px !important;
            background: white !important;
            border: 1px solid #ddd !important;
            border-radius: 8px !important;
            font-size: 11px !important;
            color: #333 !important;
            text-decoration: none !important;
            min-height: 50px !important;
            cursor: pointer !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            font-weight: 500 !important;
            line-height: 1.2 !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
        `;
        
        // 3. 로그인정보 버튼
        const loginBtn = document.createElement('button');
        loginBtn.innerHTML = '<span style="font-size: 16px; margin-bottom: 2px;">👤</span><br>로그인정보';
        loginBtn.onclick = () => {
            // 사용자 정보 표시 또는 로그아웃
            const userInfo = localStorage.getItem('user_info');
            if (userInfo) {
                const user = JSON.parse(userInfo);
                if (confirm(`${user.username}님, 로그아웃 하시겠습니까?`)) {
                    handleLogout();
                }
            }
        };
        loginBtn.style.cssText = `
            flex: 1 !important;
            padding: 10px 5px !important;
            background: white !important;
            border: 1px solid #ddd !important;
            border-radius: 8px !important;
            font-size: 11px !important;
            color: #333 !important;
            text-decoration: none !important;
            min-height: 50px !important;
            cursor: pointer !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            font-weight: 500 !important;
            line-height: 1.2 !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
        `;
        
        // 버튼들을 컨테이너에 추가
        buttonsContainer.appendChild(benefitsBtn);
        buttonsContainer.appendChild(channelBtn);
        buttonsContainer.appendChild(loginBtn);
        
        // 헤더 컨텐츠에 추가
        headerContent.appendChild(buttonsContainer);
    }
    
    // 하단 혜택 패널 토글 함수
    function toggleBenefitPanel() {
        const panel = document.getElementById('mobile-benefit-panel');
        const text = document.getElementById('benefit-panel-text');
        
        if (panel.classList.contains('collapsed')) {
            panel.classList.remove('collapsed');
            panel.classList.add('expanded');
            text.textContent = '가전 구독 혜택 ▼';
        } else {
            panel.classList.remove('expanded');
            panel.classList.add('collapsed');
            text.textContent = '가전 구독 혜택 ▲';
        }
    }
    
    // 모바일 UI 표시/숨김 함수
    function updateMobileUI() {
        const isMobile = window.innerWidth <= 768;
        const benefitPanel = document.getElementById('mobile-benefit-panel');
        const container = document.getElementById('mobile-buttons-container');
        
        if (isMobile) {
            // 모바일: 버튼과 패널 표시
            if (benefitPanel) benefitPanel.style.display = 'block';
            createMobileButtons();
        } else {
            // 데스크톱: 모바일 요소들 숨김
            if (benefitPanel) benefitPanel.style.display = 'none';
            if (container) container.remove();
        }
    }
    
    // DOM 로드 후 실행
    document.addEventListener('DOMContentLoaded', () => {
        createMobileButtons();
        updateMobileUI();
    });
    
    // 화면 크기 변경 시 다시 체크
    window.addEventListener('resize', updateMobileUI);
    
    // 전역 함수로 노출
    window.toggleBenefitPanel = toggleBenefitPanel;
    </script>
</body>
</html>