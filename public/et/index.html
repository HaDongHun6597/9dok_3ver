<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>구독 간편조회 - 전자랜드</title>
    <link rel="stylesheet" href="../shared/style.css">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../mobile.css">
    <script>window.CHANNEL = 'et';</script>
</head>
<body>
    <script src="/auth.js"></script>
    <div class="container">
        <!-- 헤더 -->
        <header class="header">
            <div class="header-content">
                <h1>구독 간편조회<span class="channel-version">&nbsp; (전자랜드) ver3</span></h1>
                <a href="/" class="back-to-main" style="position: fixed; right: 220px; top: 25px; text-decoration: none; color: #666; font-size: 13px; display: flex; align-items: center; gap: 5px; padding: 8px 12px; background: white; border-radius: 6px; transition: all 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #ddd; height: 36px; box-sizing: border-box;" onmouseover="this.style.background='#f5f5f5'; this.style.color='#333';" onmouseout="this.style.background='white'; this.style.color='#666';">
                    <span style="font-size: 16px;">←</span> 채널 선택
                </a>
            </div>
        </header>

        <div class="main-content">
            <!-- 왼쪽 계산기 영역 -->
            <aside class="calculator-sidebar">
                <div class="calculator-header">
                    <h2>가전구독 혜택</h2>
                    <label style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); display: flex; align-items: center; font-size: 12px; color: #666; cursor: pointer;">
                        <input type="checkbox" id="showTotalCost" style="margin-right: 5px; cursor: pointer;">
                        총혜택 보기
                    </label>
                </div>
                
                <!-- 구독 타입별 혜택 -->
                <div class="benefit-section">
                    <div class="benefit-item active" data-type="single">
                        <div class="benefit-title">정상 구독료</div>
                        <div class="benefit-price" id="normalPrice">0원</div>
                    </div>
                    
                    <div class="benefit-item" data-type="promotion">
                        <div class="benefit-header">
                            <div class="benefit-title">추가혜택</div>
                        </div>
                        <div class="benefit-price" id="promotionPrice">0원</div>
                        <div class="benefit-details" id="benefitDetails">
                            <div class="benefit-detail" id="promotionDiscountDetail">• 프로모션할인: 0원</div>
                            <div class="benefit-detail" id="combinationDiscountDetail">• 결합할인: 0원</div>
                            <div class="benefit-detail" id="partnerCardDetail">• 제휴카드: 0원</div>
                        </div>
                    </div>
                    
                    <div class="benefit-item prepayment-section" id="prepaymentSection" style="display: none;">
                        <div class="benefit-title">선납금액 💳</div>
                        <div class="benefit-price prepayment-price" id="prepaymentPrice">0원</div>
                        <div class="benefit-details">
                            <div class="benefit-detail small-text">선납 선택 시 한번에 납부할 금액</div>
                            <div class="benefit-detail" id="prepaymentDetail">• 해당 제품 없음</div>
                        </div>
                    </div>
                </div>
                
                <div class="final-total">
                    <div class="final-message">최종 체감 구독료(월)입니다.</div>
                    <div class="final-price" id="finalPrice">0원</div>
                </div>
            </aside>

            <!-- 우측 제품 선택 영역 -->
            <main class="products-main">
                <div class="products-header">
                    <button id="subscriptionBenefitsBtn" class="subscription-benefits-btn">
                        <span class="benefits-icon">🎁</span>
                        <span>구독 혜택</span>
                    </button>
                </div>
                <div class="products-grid" id="productsGrid">
                    <!-- 선택된 제품 카드들이 여기에 표시됩니다 -->
                    <div class="add-product-card" id="addProductCard">
                        <div class="add-product-content">
                            <div class="add-icon">+</div>
                            <div class="add-text">제품 추가</div>
                        </div>
                    </div>
                </div>
                
                <!-- 웰컴 메시지 (제품이 없을 때) -->
                <div class="welcome-message" id="welcomeMessage">
                    <h3>구독하고 싶은 제품을 선택해보세요</h3>
                    <p>다양한 가전제품을 월 구독료로 이용할 수 있습니다.</p>
                </div>
            </main>
        </div>
        
        <!-- 워터마크 시그니처 -->
        <div class="watermark-signature">designed by 하동훈</div>
    </div>
    
    <!-- 모바일 총혜택보기 토글 -->
    <div class="mobile-total-toggle" style="display: none;" id="mobileTotalToggle">
        <label>
            <input type="checkbox" id="mobileShowTotalCost">
            <span>총혜택 보기</span>
        </label>
    </div>

    <!-- 제품 선택 모달 -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>제품 선택</h2>
                <span class="close-btn" id="closeModal">&times;</span>
            </div>
            
            <!-- 단계 표시기 -->
            <div class="step-indicator">
                <div class="step active" data-step="1">
                    <span class="step-number">1</span>
                    <span class="step-label">제품군</span>
                </div>
                <div class="step" data-step="2">
                    <span class="step-number">2</span>
                    <span class="step-label">모델명</span>
                </div>
                <div class="step" data-step="3">
                    <span class="step-number">3</span>
                    <span class="step-label">결합유형</span>
                </div>
                <div class="step" data-step="4">
                    <span class="step-number">4</span>
                    <span class="step-label">계약기간</span>
                </div>
                <div class="step" data-step="5">
                    <span class="step-number">5</span>
                    <span class="step-label">관리유형</span>
                </div>
                <div class="step" data-step="6">
                    <span class="step-number">6</span>
                    <span class="step-label">방문주기</span>
                </div>
                <div class="step" data-step="7">
                    <span class="step-number">7</span>
                    <span class="step-label">선납</span>
                </div>
            </div>

            <!-- 스크롤 가능한 내용 영역 -->
            <div class="modal-scroll-content">
                <!-- 단계별 선택 영역 -->
                <div class="step-content">
                    <div class="step-header">
                        <div class="step-title" id="stepTitle">제품군을 선택해주세요</div>
                        <button id="prevBtnTop" class="btn btn-secondary btn-small" style="display: none;">← 이전</button>
                    </div>
                    
                    <!-- 검색창 (많은 옵션이 있을 때만 표시) -->
                    <div class="search-section" id="searchSection" style="display: none;">
                        <input type="text" id="optionSearch" placeholder="검색어를 입력하세요..." />
                        <div class="search-result-count" id="searchResultCount"></div>
                    </div>
                    
                    <div class="options-grid" id="optionsGrid">
                        <!-- 선택 옵션들이 동적으로 추가됩니다 -->
                    </div>
                </div>

                <!-- 선택 내역 표시 -->
                <div class="selection-summary">
                    <h4>선택 내역</h4>
                    <div class="selection-items" id="selectionItems">
                        <!-- 선택된 내역들이 표시됩니다 -->
                    </div>
                </div>

                <!-- 버튼 영역 (자동 진행으로 인해 숨김) -->
                <div class="modal-footer" style="display: none;">
                    <button id="skipBtn" class="btn btn-secondary">건너뛰기</button>
                    <button id="addBtn" class="btn btn-success">제품 추가</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 제휴카드 모달 -->
    <div id="partnerCardModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>제휴카드 선택</h2>
                <span class="close-btn" onclick="calculator.closePartnerCardModal()">&times;</span>
            </div>
            
            <div class="modal-body">
                <p>제품에 적용할 제휴카드를 선택해주세요.</p>
                <div id="partnerCardOptions" class="partner-card-grid">
                    <!-- 제휴카드 옵션들이 여기에 동적으로 추가됩니다 -->
                </div>
            </div>
            
            <div class="modal-footer">
                <button onclick="calculator.closePartnerCardModal()" class="btn btn-secondary">취소</button>
                <button onclick="calculator.applyPartnerCard()" class="btn btn-primary">적용</button>
            </div>
        </div>
    </div>

    <!-- 구독 혜택 모달 -->
    <div id="subscriptionBenefitsModal" class="modal">
        <div class="modal-content benefits-modal-content">
            <div class="modal-header">
                <h2>구독 혜택</h2>
                <span class="close-btn" onclick="closeBenefitsModal()">&times;</span>
            </div>
            
            <div class="modal-body">
                <p>구독 시 받을 수 있는 다양한 케어 서비스 혜택을 확인해보세요.</p>
                <div id="benefitsGrid" class="benefits-grid">
                    <!-- 구독 혜택 버튼들이 여기에 동적으로 추가됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 구독 혜택 상세 모달 -->
    <div id="benefitDetailModal" class="modal">
        <div class="modal-content benefit-detail-content">
            <div class="modal-header">
                <h2 id="benefitDetailTitle">혜택 상세</h2>
                <span class="close-btn" onclick="closeBenefitDetailModal()">&times;</span>
            </div>
            
            <div class="modal-body">
                <div id="benefitDetailContent">
                    <!-- 상세 내용이 여기에 로드됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <script src="../shared/script.js"></script>
    <script src="../product-modal.js"></script>
    <script src="../script.js"></script>
    
    <!-- 모바일 하단 혜택 계산 패널 -->
    <div id="mobile-benefit-panel" class="mobile-benefit-panel collapsed" style="display: none;">
        <div class="mobile-benefit-header" onclick="toggleBenefitPanel()">
            <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                <span style="font-size: 14px; color: #fff;">최종 체감 구독료(월)</span>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span id="mobile-final-price" style="font-size: 20px; font-weight: bold; color: #fff;">0원</span>
                    <span id="benefit-panel-arrow" style="font-size: 14px; color: #fff;">▲</span>
                </div>
            </div>
        </div>
        <div class="mobile-benefit-content" style="padding: 20px;">
            <h3 style="font-size: 16px; margin: 0 0 15px 0; color: #333;">가전구독 혜택</h3>
            
            <!-- 정상 구독료 -->
            <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin-bottom: 10px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 14px; color: #666;">정상 구독료</span>
                    <span id="mobile-normal-price" style="font-size: 16px; font-weight: 600; color: #333;">0원</span>
                </div>
            </div>
            
            <!-- 추가혜택 -->
            <div style="background: #fff3cd; padding: 12px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #ffc107;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <span style="font-size: 14px; color: #666;">추가혜택</span>
                    <span id="mobile-promotion-price" style="font-size: 16px; font-weight: 600; color: #dc3545;">0원</span>
                </div>
                <div id="mobile-benefit-details" style="font-size: 12px; color: #666;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 2px 0;">
                        <span>• 프로모션할인:</span>
                        <span id="mobile-promotion-discount">0원</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 2px 0;">
                        <span>• 결합할인:</span>
                        <span id="mobile-combination-discount">0원</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 2px 0;">
                        <span>• 제휴카드:</span>
                        <span id="mobile-partner-card">0원</span>
                    </div>
                </div>
            </div>
            
            <!-- 선납금액 (필요시 표시) -->
            <div id="mobile-prepayment-section" style="background: #e3f2fd; padding: 12px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #2196f3; display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 14px; color: #666;">선납금액 💳</span>
                    <span id="mobile-prepayment-price" style="font-size: 16px; font-weight: 600; color: #1976d2;">0원</span>
                </div>
                <div style="font-size: 11px; color: #666; margin-top: 5px;">선납 선택 시 한번에 납부할 금액</div>
            </div>
            
            <!-- 최종 금액 -->
            <div style="background: linear-gradient(135deg, #A50034, #8A002A); padding: 12px; border-radius: 8px; color: white; margin-bottom: 10px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 14px;">최종 체감 구독료(월)</span>
                    <span id="mobile-final-price-detail" style="font-size: 18px; font-weight: bold;">0원</span>
                </div>
            </div>
            
            <!-- 총혜택 보기 체크 시 표시 -->
            <div id="mobile-total-cost-section" style="background: #f8f8fc; padding: 12px; border-radius: 8px; display: none; border: 1px solid #e0e0e0;">
                <div style="font-weight: bold; margin-bottom: 10px; color: #333; font-size: 14px;">전체 계약기간 총 비용</div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                    <span style="font-size: 13px; color: #666;">계약기간:</span>
                    <span id="mobile-contract-period" style="font-size: 13px; color: #333;">-</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                    <span style="font-size: 13px; color: #666;">정가 합계:</span>
                    <span id="mobile-total-original" style="font-size: 13px; color: #333;">0원</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                    <span style="font-size: 13px; color: #666;">총 혜택:</span>
                    <span id="mobile-total-benefits" style="font-size: 13px; color: #dc3545;">-0원</span>
                </div>
                <div style="border-top: 1px solid #ddd; margin-top: 8px; padding-top: 8px; display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 14px; font-weight: bold; color: #333;">실 지불총액:</span>
                    <span id="mobile-total-cost" style="font-size: 16px; font-weight: bold; color: #1976d2;">0원</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 모바일 UI 스크립트 -->
    <script>
    
    // 하단 혜택 패널 토글 함수
    function toggleBenefitPanel() {
        const panel = document.getElementById('mobile-benefit-panel');
        const arrow = document.getElementById('benefit-panel-arrow');
        
        if (panel.classList.contains('collapsed')) {
            panel.classList.remove('collapsed');
            panel.classList.add('expanded');
            arrow.textContent = '▼';
        } else {
            panel.classList.remove('expanded');
            panel.classList.add('collapsed');
            arrow.textContent = '▲';
        }
    }
    
    // 모바일 혜택 계산 패널 데이터 업데이트
    function updateMobileBenefitPanel() {
        // PC의 계산기 데이터를 모바일 패널에 반영
        const normalPrice = document.getElementById('normalPrice');
        const promotionPrice = document.getElementById('promotionPrice');
        const finalPrice = document.getElementById('finalPrice');
        const prepaymentSection = document.getElementById('prepaymentSection');
        const prepaymentPrice = document.getElementById('prepaymentPrice');
        
        if (normalPrice) document.getElementById('mobile-normal-price').textContent = normalPrice.textContent;
        if (promotionPrice) document.getElementById('mobile-promotion-price').textContent = promotionPrice.textContent;
        if (finalPrice) {
            document.getElementById('mobile-final-price').textContent = finalPrice.textContent;
            document.getElementById('mobile-final-price-detail').textContent = finalPrice.textContent;
        }
        
        // 추가혜택 상세 - PC에서 span의 두 번째 요소(금액)를 가져옴
        const promotionDiscount = document.getElementById('promotionDiscountDetail');
        const combinationDiscount = document.getElementById('combinationDiscountDetail');
        const partnerCard = document.getElementById('partnerCardDetail');
        
        if (promotionDiscount) {
            const promotionAmount = promotionDiscount.querySelector('span:last-child')?.textContent || '0원';
            document.getElementById('mobile-promotion-discount').textContent = promotionAmount;
        }
        if (combinationDiscount) {
            const combinationAmount = combinationDiscount.querySelector('span:last-child')?.textContent || '0원';
            document.getElementById('mobile-combination-discount').textContent = combinationAmount;
        }
        if (partnerCard) {
            const partnerAmount = partnerCard.querySelector('span:last-child')?.textContent || '0원';
            document.getElementById('mobile-partner-card').textContent = partnerAmount;
        }
        
        // 선납금액 표시 여부
        if (prepaymentSection && prepaymentSection.style.display !== 'none') {
            document.getElementById('mobile-prepayment-section').style.display = 'block';
            if (prepaymentPrice) document.getElementById('mobile-prepayment-price').textContent = prepaymentPrice.textContent;
        } else {
            document.getElementById('mobile-prepayment-section').style.display = 'none';
        }
        
        // 총혜택 보기 체크 여부 확인 및 총 비용 표시
        const showTotalCost = document.getElementById('showTotalCost');
        const mobileTotalSection = document.getElementById('mobile-total-cost-section');
        
        if (showTotalCost && showTotalCost.checked && mobileTotalSection) {
            // PC의 updateTotalCostSummary와 동일한 로직 사용
            if (window.calculator && window.calculator.selectedProducts.length > 0) {
                let totalContractCost = 0;
                let totalBenefits = 0;
                let actualTotalPayment = 0;
                let maxContractMonths = 0;
                
                window.calculator.selectedProducts.forEach(product => {
                    const monthlyFee = window.calculator.parsePrice(product['월요금']);
                    const contractPeriod = product['계약기간'];
                    if (!contractPeriod) return;
                    
                    const contractMonths = parseInt(contractPeriod.replace('년', '')) * 12;
                    if (contractMonths > maxContractMonths) maxContractMonths = contractMonths;
                    
                    const totalMonthlyFee = monthlyFee * contractMonths;
                    
                    // 카드 혜택 계산
                    let totalCardBenefit = 0;
                    if (product.partnerCard) {
                        const periodInfo = window.calculator.calculatePeriodBasedDiscount(contractPeriod, product.partnerCard);
                        if (periodInfo.promotionPeriod > 0) {
                            totalCardBenefit += Math.min(product.partnerCard.promotionDiscount, monthlyFee) * periodInfo.promotionPeriod;
                        }
                        if (periodInfo.basicPeriod > 0) {
                            totalCardBenefit += Math.min(product.partnerCard.basicDiscount, monthlyFee) * periodInfo.basicPeriod;
                        }
                    }
                    
                    // 활성화 혜택
                    const activationDiscount = window.calculator.parsePrice(product['활성화']) || 0;
                    const promotionMonths = parseInt(product['프로모션할인종료월'] || '0');
                    const totalActivationBenefit = activationDiscount * promotionMonths;
                    
                    // 결합할인 혜택
                    const combinationDiscount = window.calculator.parsePrice(product['할인금액']) || 0;
                    const totalCombinationBenefit = combinationDiscount * contractMonths;
                    
                    const productTotalBenefit = totalCardBenefit + totalActivationBenefit + totalCombinationBenefit;
                    const productActualCost = totalMonthlyFee - productTotalBenefit;
                    
                    totalContractCost += totalMonthlyFee;
                    totalBenefits += productTotalBenefit;
                    actualTotalPayment += productActualCost;
                });
                
                // 모바일 총 비용 섹션 업데이트
                document.getElementById('mobile-contract-period').textContent = maxContractMonths ? `${maxContractMonths}개월` : '-';
                document.getElementById('mobile-total-original').textContent = totalContractCost > 0 ? `${totalContractCost.toLocaleString()}원` : '0원';
                document.getElementById('mobile-total-benefits').textContent = totalBenefits > 0 ? `-${totalBenefits.toLocaleString()}원` : '-0원';
                document.getElementById('mobile-total-cost').textContent = actualTotalPayment > 0 ? `${actualTotalPayment.toLocaleString()}원` : '0원';
            }
            
            mobileTotalSection.style.display = 'block';
        } else if (mobileTotalSection) {
            mobileTotalSection.style.display = 'none';
        }
    }
    
    // 모바일 UI 표시/숨김 함수
    function updateMobileUI() {
        const isMobile = window.innerWidth <= 768;
        const benefitPanel = document.getElementById('mobile-benefit-panel');
        const totalToggle = document.getElementById('mobileTotalToggle');
        const container = document.getElementById('mobile-buttons-container');
        
        if (isMobile) {
            // 모바일: 패널과 토글 표시
            if (benefitPanel) benefitPanel.style.display = 'block';
            if (totalToggle) totalToggle.style.display = 'flex';
        } else {
            // 데스크톱: 모바일 요소들 숨김
            if (benefitPanel) benefitPanel.style.display = 'none';
            if (totalToggle) totalToggle.style.display = 'none';
            if (container) container.remove();
        }
    }
    
    // 모바일에서 user-info-container 위치 조정 (전역 함수로 이동)
    function adjustUserInfoPosition() {
            const container = document.getElementById('user-info-container');
            if (!container) return;
            
            const isMobile = window.innerWidth <= 768;
            
            if (isMobile) {
                // 모바일: 헤더로 이동
                container.style.position = '';
                container.style.top = '';
                container.style.right = '';
                container.style.zIndex = '';
                
                const headerContent = document.querySelector('.header-content');
                if (headerContent && !headerContent.contains(container)) {
                    headerContent.appendChild(container);
                }
                
                // 구독혜택 버튼 추가 (모바일에서만)
                const backToMain = container.querySelector('.back-to-main');
                if (backToMain && !container.querySelector('.mobile-benefits-btn')) {
                    const benefitsBtn = document.createElement('a');
                    benefitsBtn.className = 'mobile-benefits-btn';
                    benefitsBtn.href = '#';
                    benefitsBtn.style.cssText = 'text-decoration: none; color: #666; font-size: 12px; display: flex; align-items: center; gap: 5px; padding: 6px 10px; background: white; border-radius: 6px; transition: all 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #ddd; height: 32px; box-sizing: border-box; white-space: nowrap;';
                    benefitsBtn.innerHTML = '<span style="font-size: 16px;">🎁</span> 구독혜택';
                    
                    benefitsBtn.onclick = (e) => {
                        e.preventDefault();
                        const desktopBtn = document.querySelector('.subscription-benefits-btn');
                        if (desktopBtn) desktopBtn.click();
                    };
                    
                    benefitsBtn.onmouseover = function() {
                        this.style.background = '#f5f5f5';
                        this.style.color = '#333';
                    };
                    benefitsBtn.onmouseout = function() {
                        this.style.background = 'white';
                        this.style.color = '#666';
                    };
                    
                    container.insertBefore(benefitsBtn, backToMain);
                }
            } else {
                // PC: 원래 위치로 복원
                container.style.position = 'fixed';
                container.style.top = '25px';
                container.style.right = '30px';
                container.style.zIndex = '1000';
                
                // body로 다시 이동
                if (!document.body.contains(container) || container.parentElement !== document.body) {
                    document.body.appendChild(container);
                }
                
                // 모바일 구독혜택 버튼 제거
                const mobileBenefitsBtn = container.querySelector('.mobile-benefits-btn');
                if (mobileBenefitsBtn) {
                    mobileBenefitsBtn.remove();
                }
        }
    }
    
    // DOM 로드 후 실행
    document.addEventListener('DOMContentLoaded', () => {
        updateMobileUI();
        
        // 초기 로드 시 모바일 패널 업데이트
        if (window.innerWidth <= 768) {
            setTimeout(() => {
                updateMobileBenefitPanel();
            }, 500);
        }
        
        // MutationObserver로 user-info-container 생성 감지
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                mutation.addedNodes.forEach((node) => {
                    if (node.id === 'user-info-container') {
                        adjustUserInfoPosition();
                    }
                });
            });
        });
        
        observer.observe(document.body, { 
            childList: true, 
            subtree: true 
        });
        
        // 이미 존재하는 경우 즉시 조정
        adjustUserInfoPosition();
        
        // 계산기 업데이트 감지 (모바일 패널 업데이트용)
        const calculatorObserver = new MutationObserver(() => {
            if (window.innerWidth <= 768) {
                console.log('계산기 업데이트 감지 - 모바일 패널 업데이트');
                updateMobileBenefitPanel();
            }
        });
        
        const finalPriceEl = document.getElementById('finalPrice');
        if (finalPriceEl) {
            calculatorObserver.observe(finalPriceEl, { 
                childList: true, 
                characterData: true,
                subtree: true 
            });
        }
        
        // PC 계산기의 모든 요소 감지
        const normalPriceEl = document.getElementById('normalPrice');
        if (normalPriceEl) {
            calculatorObserver.observe(normalPriceEl, { 
                childList: true, 
                characterData: true,
                subtree: true 
            });
        }
        
        // 총혜택 보기 체크박스 변경 감지
        const showTotalCost = document.getElementById('showTotalCost');
        const mobileShowTotalCost = document.getElementById('mobileShowTotalCost');
        
        if (showTotalCost) {
            showTotalCost.addEventListener('change', () => {
                console.log('PC 총혜택 체크박스 변경:', showTotalCost.checked);
                // 제품 카드의 총 비용 섹션 표시/숨김
                if (window.calculator) {
                    window.calculator.toggleTotalCostDisplay(showTotalCost.checked);
                }
                if (window.innerWidth <= 768) {
                    // 모바일 체크박스도 동기화
                    if (mobileShowTotalCost) {
                        mobileShowTotalCost.checked = showTotalCost.checked;
                    }
                    updateMobileBenefitPanel();
                }
            });
        }
        
        if (mobileShowTotalCost) {
            mobileShowTotalCost.addEventListener('change', () => {
                console.log('모바일 총혜택 체크박스 변경:', mobileShowTotalCost.checked);
                // PC 체크박스도 동기화
                if (showTotalCost) {
                    showTotalCost.checked = mobileShowTotalCost.checked;
                }
                // 제품 카드의 총 비용 섹션 표시/숨김
                if (window.calculator) {
                    window.calculator.toggleTotalCostDisplay(mobileShowTotalCost.checked);
                }
                updateMobileBenefitPanel();
            });
        }
    });
    
    // 화면 크기 변경 시 다시 체크
    window.addEventListener('resize', () => {
        updateMobileUI();
        adjustUserInfoPosition();
    });
    
    // 전역 함수로 노출
    window.toggleBenefitPanel = toggleBenefitPanel;
    </script>
</body>
</html>